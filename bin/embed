#!/usr/bin/env python3

import sys
import gzip
import wnix
import base64

model = wnix.embed.FlagEmbed()
stdin = sys.stdin.read()
embed = model(stdin)
embed = [float(f"{s:.03f}") for s in embed.tolist()]
line = json.dumps(embed)

args = set(sys.argv[1:])
if {'-s', '--squeeze'} & args:
    line = line.replace(' ', '')
if {'-z', '--gzip'} & args:
    line = gzip.compress(line.encode())
if {'-b', '--base64'} & args:
    line = base64.encodebytes(line).decode().replace('\n', '')

print(line)
